<!DOCTYPE html>
<html lang="ja"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculator</title>
</head>

<body>
  <div class="main">
    <div class="calculator">
      <form action="" name="form" id="calcForm">
        <table class="calculator-table">
          <tbody><tr>
            <td colspan="5">   
              <input type="text" name="text" value="0" class="calculation-place" disabled="">　
            </td>
          </tr>
          <tr class="calculator-tr">
            <td><input type="button" value="MR" onclick="calc('MR')" class="calculation-button symbol"></td>
            <td><input type="button" value="MC" onclick="calc('MC')" class="calculation-button symbol"></td>
            <td><input type="button" value="M＋" onclick="calc('M＋')" class="calculation-button symbol"></td>
            <td><input type="button" value="M－" onclick="calc('M－')" class="calculation-button symbol"></td>
            <td><input type="button" value="÷" onclick="calc('÷')" class="calculation-button symbol"></td>
          </tr>
          <tr class="calculator-tr">　
            <td><input type="button" value="C" onclick="calc('C')" class="calculation-button symbol"></td>
            <td><input type="button" value="7" onclick="calc('7')" class="calculation-button num"></td>
            <td><input type="button" value="8" onclick="calc('8')" class="calculation-button num"></td>
            <td><input type="button" value="9" onclick="calc('9')" class="calculation-button num"></td>
            <td><input type="button" value="×" onclick="calc('×')" class="calculation-button symbol"></td>
          </tr>
          <tr class="calculator-tr">
            <td><input type="button" value="del" onclick="calc('del')" class="calculation-button symbol"></td>
            <td><input type="button" value="4" onclick="calc('4')" class="calculation-button num"></td>
            <td><input type="button" value="5" onclick="calc('5')" class="calculation-button num"></td>
            <td><input type="button" value="6" onclick="calc('6')" class="calculation-button num"></td>
            <td><input type="button" value="-" onclick="calc('-')" class="calculation-button symbol"></td>
          </tr>
          <tr>
            <td><input type="button" value="√" onclick="calc('√')" class="calculation-button symbol"></td>
            <td><input type="button" value="1" onclick="calc('1')" class="calculation-button num"></td>
            <td><input type="button" value="2" onclick="calc('2')" class="calculation-button num"></td>
            <td><input type="button" value="3" onclick="calc('3')" class="calculation-button num"></td>
            <td><input type="button" value="+" onclick="calc('+')" class="calculation-button symbol"></td>
          </tr>
          <tr>
            <td><input type="button" value="+/-" onclick="calc('+/-')" class="calculation-button symbol"></td>
            <td><input type="button" value="0" onclick="calc('0')" class="calculation-button num"></td>
            <td><input type="button" value="00" onclick="calc('00')" class="calculation-button num"></td>
            <td><input type="button" value="." onclick="calc('.')" class="calculation-button symbol"></td>
            <td><input type="button" value="=" onclick="calc('=')" class="calculation-button equal"></td>
          </tr>
        </tbody></table>
      </form>
    </div>
  </div>


<style>
body{
  background-color: #b6cff5;
}


.main{
  margin: 0px 100px;
}

.calculator{
  margin: 0px 150px;
  margin-bottom: 100px;    
	height: 50px;
	background-color: #b6cff5;
}
.calculator-table{
    table-layout: fixed;
    width: 500px;
    height: 300px;
    background-color: #b6cff5;
}

.calculation-place{
background-color: #7b7676;
  border-color: #000;
  text-align: right;
  color: #fff;
  letter-spacing: 4px;
  padding: 5px;
  width: 97%;
  font-size: 4em;
  outline: solid 1px rgb(127, 127, 129);
}

.calculation-button{
    width: 100%;
  height: 60px;
  color: #fff;
  cursor: pointer;
  font-size: calc(20px + 0.8vw);
  outline: solid 1px rgb(124, 124, 129);
}

.symbol{
  background-color: rgba(32, 32, 32, 0.8);
  border-color: #323232;
}

.symbol:hover{
  background-color: rgba(63, 141, 93, 0.8);
}

.num{
  background-color: rgba(0,0,0,0.8);
  border-color: rgb(39, 39, 39);
}

.num:hover{
  background-color: rgba(63, 141, 93, 0.8);
}

.equal{
  background-color: rgba(238, 95, 52, 0.8);
  border-color:rgba(238, 95, 52, 0.8);
}

.equal:hover{
  background-color: rgba(63, 141, 93, 0.8)
}
</style>

<script>
  var kekka = false; // 計算結果の変数
  var gennzainoenzannsi = ''; // 現在の演算子の変数
  var gennzainonyuuryokuti = '0'; // 現在の入力値の変数
  var maenonyuuryokuti = ''; // 前の入力値の変数
  var nyuuryokumati = false; // 演算子入力後に次の入力を待つ変数
  var memoryValue = 0; // メモリーの値を保持する変数

  // 電卓の動作を制御する関数
  // sign はクリックしたボタン
  function calc(sign) {  //ｃを押したらリセットと表示を更新する関数を呼ぶ
    if (sign === 'C') {
      denntakurisseto();
      hyoujikousinn();
      return;
    }
    if (sign === '00') {  //00を押したら00を表示する関数を呼ぶ
      if (nyuuryokumati === false) {//演算子入力後に反応しなくする。　　　
        zerozerobutton();
        hyoujikousinn();
        return;
      }
      return;
    }
    if (sign === 'M－') {  //M-を押したらメモリーから引く関数を呼ぶ
      mmainasubutton();
      hyoujikousinn();
      return;
    }
    if (sign === 'M＋') {　//M+を押したらメモリーに足する関数を呼ぶ
      mplusbutton();
      hyoujikousinn();
      return;
    }
    if (kekka === true || nyuuryokumati === true) { //計算結果が表示されているか、演算子入力後に次の入力を待つ場合
      nyuuryokugoshori(sign);
    } else {
      tuujounyuuryokushori(sign);
    }

    hyoujikousinn();
  }

  function mrbutton() {//MRボタンの関数
    if (nyuuryokumati === true || memoryValue === 0) {//演算子入力後に反応しなくする。
      return;
    }
    gennzainonyuuryokuti = memoryValue.toString(); // メモリーの値を表示
    hyoujikousinn();
  }

  function mcbutton() {//MCボタンの関数
    if (nyuuryokumati === true) {//演算子入力後に反応しなくする。
      return;
    }
    memoryValue = 0; // メモリーの値をクリア
    hyoujikousinn();
  }


  function mplusbutton() {//M+ボタンの関数
    if (nyuuryokumati) {//演算子入力後に反応しなくする。
      return;
    }
    
    memoryValue += parseFloat(gennzainonyuuryokuti); // parseFloatで現在の入力値を数字にする。
    hyoujikousinn();
  }

  function mmainasubutton() {//M-ボタンの関数
    if (nyuuryokumati) {//演算子入力後に反応しなくする。
      return;
    }
    memoryValue -= parseFloat(gennzainonyuuryokuti); // メモリーから引く
    hyoujikousinn();
  }

  function rutobutton() {//√ボタンの関数
    var inputValue = parseFloat(gennzainonyuuryokuti);
    if (inputValue < 0) {
      gennzainonyuuryokuti = 'error';    //負の数の平方根エラー
    } else {
      gennzainonyuuryokuti = Math.sqrt(inputValue).toString();//Math.sqrtで平方根を計算する。

    }
  }

  function denntakurisseto() {//電卓の状態をリセットする関数
    kekka = false; //結果が表示されていないとき
    maenonyuuryokuti = ''; //前の入力値を空にする
    gennzainonyuuryokuti = '0'; //現在の入力値を0にする
    gennzainoenzannsi = ''; //演算子を空にする
    nyuuryokumati = false; //演算子入力後に次の入力を待つ変数
  }

  function zerozerobutton() {//00ボタンの関数
    if (nyuuryokumati === true) {//演算子入力後に反応しなくする。
      return;
    }
    if (kekka === true) {//計算結果が表示されているとき反応しない
      return;
    }
    if (gennzainonyuuryokuti === '0') {//現在の入力値が0の場合
      gennzainonyuuryokuti = '0';//０にする
      return;
    } 
    
    if (isNaN(gennzainonyuuryokuti) === false) {//現在の入力値が数字の場合
      gennzainonyuuryokuti = gennzainonyuuryokuti + '00';//00を追加する
    }
  }

  // 入力後の処理の関数の作成
  // 計算結果表示後または演算子入力後の入力処理
  function nyuuryokugoshori(sign) {
    if (kekka === true) { // 計算結果が表示されている場合
      if (sign === 'M＋') {//M+を押したらメモリーに足す関数を呼ぶ
        mplusbutton();
      } else if (sign === 'M－') {//M-を押したらメモリーから引く関数を呼ぶ
        mmainasubutton();
      } else if (sign === 'MR') {//MRを押したらメモリーの値を表示する関数を呼ぶ
        mrbutton();
      } else if (sign === 'MC') {//MCを押したらメモリーをクリアする関数を呼ぶ
        mcbutton();
      }
      return;
    }
    if (isNaN(sign) === false) {//数字を押したら
      gennzainonyuuryokuti = sign;//現在の入力値を数字にする
      nyuuryokumati = false;//演算子入力後に次の入力を待つ変数をfalseにする
      kekka = false;//計算結果が表示されていないとき
    } else if (sign === '.') {//小数点を押したら
      gennzainonyuuryokuti = '0.';//0.にする
      nyuuryokumati = false;//演算子入力後に次の入力を待つ変数をfalseにする
      kekka = false;//計算結果が表示されていないとき
    } else if (sign === '+' || sign === '-' || sign === '×' || sign === '÷') {//演算子を押したら
      maenonyuuryokuti = gennzainonyuuryokuti;
      gennzainoenzannsi = sign;
      nyuuryokumati = true;
    }
  }

  // 入力値が数字じゃない場合と小数点かどうかを判定する関数
  function suujikashousuutennka(sign) {
    return !isNaN(sign) || sign === '.';
  }

  // 通常時の入力処理
  function tuujounyuuryokushori(sign) {
    if (sign === '=') {//イコールを押したとき。
      keisannsurukannsuu();//計算を実行する関数を呼ぶ
    } else if (sign === '+' || sign === '-' || sign === '×' || sign === '÷') {//演算子を押したとき
      ennzannsinoshori();//演算子入力時の処理
      maenonyuuryokuti = gennzainonyuuryokuti;//前の入力値を現在の入力値にする
      gennzainoenzannsi = sign;//演算子を保存する
      nyuuryokumati = true;//演算子入力後に次の入力を待つ変数をtrueにする
    } else if (sign === '+/-') {
      purasumainasu();
    } else if (sign === 'del') {
      deletebutton();
    } else if (sign === '00') {
      zerozerobutton();
    } else if (sign === 'MR') {
      mrbutton();
    } else if (sign === 'MC') {
      mcbutton();
    } else if (sign === 'M＋') {
      mplusbutton();
    } else if (sign === 'M－') {
      mmainasubutton();
    } else if (sign === '√') {
      rutobutton();
    } else if (isNaN(sign) === false || sign === '.') {//数字か小数点を押したとき
      joukenndenyuuryokutiwotuika(sign);//数字または小数点を現在の値に追加する関数を呼ぶ
    }
  }

  // 計算を実行する関数を作成
  function keisannsurukannsuu() {
    if (maenonyuuryokuti === '' || gennzainoenzannsi === '') {//前の入力値が空か演算子が空の場合
      return;
    }
    try {
      if (gennzainonyuuryokuti.startsWith('-')) {//現在の入力値が負の数の場合
        gennzainonyuuryokuti = '(' + gennzainonyuuryokuti + ')';//括弧を追加して正しく計算する。
      }
      var sikiwonarabetaretu = maenonyuuryokuti + gennzainoenzannsi + gennzainonyuuryokuti;//演算子と前の入力値と現在の入力値を合体させる。
      sikiwonarabetaretu = sikiwonarabetaretu.replace('×', '*').replace('÷', '/');//×と÷を*と/に変換して計算できるようにする。
      var result = eval(sikiwonarabetaretu);//計算を実行する。
      if (result % 1 !== 0) {//余りが0でない場合
        result = Math.round(result * 1000000000000) / 1000000000000;//これで小数点の計算が正しくなる。Math.roundは小数点以下を四捨五入する。
      }
      gennzainonyuuryokuti = result.toString();//計算結果を表示する。
      kekka = true;//計算結果が表示されているとき
      gennzainoenzannsi = '';//演算子を空にする
      maenonyuuryokuti = '';//前の入力値を空にする
    } catch (e) {//エラーが発生した場合
      gennzainonyuuryokuti = 'error';//エラーを表示する。
    }
  }

  function purasumainasu() {//プラスマイナスを押したとき
    gennzainonyuuryokuti = (parseFloat(gennzainonyuuryokuti) * -1).toString();//現在の入力値を-1倍して表示する。
  }

  // 演算子入力時の処理
  function ennzannsinoshori() {//演算子入力時の処理
    if (maenonyuuryokuti === '' || gennzainoenzannsi === '') {//前の入力値が空か演算子が空の場合
      return;
    }
    try {
      if (gennzainonyuuryokuti.startsWith('-')) {//現在の入力値にーが含まれている場合。
        gennzainonyuuryokuti = '(' + gennzainonyuuryokuti + ')';//括弧を追加して正しく計算する。
      }
      var sikiwonarabetaretu = maenonyuuryokuti + gennzainoenzannsi + gennzainonyuuryokuti;//演算子と前の入力値と現在の入力値を合体させる。
      sikiwonarabetaretu = sikiwonarabetaretu.replace('×', '*').replace('÷', '/');//×と÷を*と/に変換して計算できるようにする。
      var result = eval(sikiwonarabetaretu);//計算を実行する。
      if (result % 1 !== 0) {//余りが0でない場合
        result = Math.round(result * 1000000000000) / 1000000000000;//これで小数点の計算が正しくなる。Math.roundは小数点以下を四捨五入する。
      }
      gennzainonyuuryokuti = result.toString();//計算結果を文字列に変換して表示文字列にする。
    } catch (e) {//エラーが発生した場合
      gennzainonyuuryokuti = 'error';//エラーを表示する。
    }
  }

  // 数字または小数点を現在の値に追加する関数
  function joukenndenyuuryokutiwotuika(sign) {
    if (gennzainonyuuryokuti === '0' && sign !== '.') {//現在の入力値が0かつ小数点でない場合
      gennzainonyuuryokuti = sign;//現在の入力値にそのままいれる。
    } else if (gennzainonyuuryokuti.indexOf('.') !== -1 && sign === '.') {//小数点が含まれていて、小数点が入力された場合。
      gennzainonyuuryokuti = gennzainonyuuryokuti;//小数点を追加しない。
    } else {
      gennzainonyuuryokuti += sign;//現在の入力値に追加する。
    }
  }

  function deletebutton() {//delボタンの関数
    if (gennzainonyuuryokuti.length <= 1) {//現在の入力値が1文字以下の場合、length文字列の長さを判定するやつ
      gennzainonyuuryokuti = '0';//0にする。
    } else {
      gennzainonyuuryokuti = gennzainonyuuryokuti.slice(0, -1);//現在の入力値の最後の文字を削除する。 
    }
  }

  // 表示を更新する関数
  function hyoujikousinn() {
    var displayValue = gennzainonyuuryokuti;
    if (memoryValue !== 0) {
      displayValue = "M " + displayValue; // メモリーが使用されている場合は "M" を表示
    }
    document.form.text.value = displayValue;
  }
</script>
</body>

</html>